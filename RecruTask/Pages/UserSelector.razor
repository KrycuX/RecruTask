@page "/userSelector"
@using RecruTask.Data
<PageTitle>Użytkownicy</PageTitle>

<MudDropContainer T="User" Items="users" ItemsSelector="ItemSelector" ItemDropped="ItemUpdated" Class="d-flex h-100">
    <ChildContent>
        <MudContainer Class="pa-6 rounded-3 w-25 h-100 bg-opacity-25 bg-white shadow ">
            <MudText Typo="Typo.h6" Class="mb-4">Użytkownicy</MudText>
            <MudDropZone T="User" Identifier="Empty" Class=" w-100 h-75 d-flex flex-wrap flex-grow-1">
               
            </MudDropZone>
            <MudDivider DividerType="DividerType.FullWidth" />
            <MudList Class="h-25 overflow-auto" >
                @foreach(var message in messages.Reverse<(string icon,string message)>())
                {
                    <MudListItem Icon="@message.icon" Text="@message.message"  />
                }
            </MudList>
        </MudContainer>
        
        <MudContainer Class=" w-75 h-100 rounded-3 bg-opacity-25 bg-white shadow mb-5">
         
            <MudTabs Elevation="25"  PanelClass=" d-flex h-100 w-100 " >
                @foreach (var item in groups)
                {
                    <MudTabPanel Text="@item.Name" Icon="@item.Icon" Class="rounded-3 d-flex w-100 h-100 text-black">
                        <MudDropZone T="User" Identifier="@item.Id.ToString()" Class="mt-6 w-100 h-100 d-flex flex-wrap flex-grow-1 bg-white " >
                  
                            </MudDropZone>
                        </MudTabPanel>
                }
            </MudTabs>
        </MudContainer>
       
    </ChildContent>
    <ItemRenderer>
        <MudPaper MinWidth="150px" MinHeight="180px" Elevation="0" Class=" rounded-3 m-2 d-grid ">
            <MudIcon Class="d-flex me-0 " Style="width:1rem"Icon="@(context.group?.Icon ?? Icons.Material.Outlined.Circle)">
            </MudIcon>
            <MudItem Class="d-flex justify-center" >
                <MudAvatar Class="d-flex justify-center" Style="width:5rem; height:5rem">
                    <MudImage Class=" d-flex bg-white justify-center" Src="@context.Image"></MudImage>
                </MudAvatar>
                 </MudItem>
               

                <MudItem Class="d-flex justify-center">@context.Name</MudItem>
               <MudItem Class="d-flex justify-center">@context.Surname</MudItem>
                <MudItem Class="d-flex rounded-bottom justify-center bg-dark text-white"> <MudIcon Icon="@Icons.Material.Filled.Map"></MudIcon>@context.City</MudItem>
        </MudPaper>
       
        </ItemRenderer>
    </MudDropContainer>

@code {
    private void ItemUpdated(MudItemDropInfo<User> dropItem)
    {
        if (dropItem.Item == null)
            return;
        if (dropItem.DropzoneIdentifier.Equals("Empty"))
        {
            if (dropItem.Item.group == null)
                return;

            messages.Add((dropItem.Item.group.Icon, $"{dropItem.Item.Name} został usunięty z grupy {dropItem.Item.group.Name}"));
            dropItem.Item.group = null;
            users.FirstOrDefault(x => x.Id == dropItem.Item.Id).group = null;
        }
        else
        {
            dropItem.Item.group = groups.FirstOrDefault(x => x.Id == Convert.ToInt32(dropItem.DropzoneIdentifier));
            users.FirstOrDefault(x => x.Id == dropItem.Item.Id).group = groups.FirstOrDefault(x => x.Id == Convert.ToInt32(dropItem.DropzoneIdentifier));
            messages.Add((dropItem.Item.group.Icon, $"{dropItem.Item.Name} został dodany do grupy {dropItem.Item.group.Name}"));
        }

    }
    private bool ItemSelector(User item,string dropzone)
    {
        if(dropzone.Equals("Empty") && item.group == null)
            return true;  
        if (item.group != null && !dropzone.Equals("Empty"))
        {
            if (item.group.Id == Convert.ToInt32(dropzone))
                return true;
            else
                return false;
        }
        return false;
    }
    List<User> users = new()
    {
        new()
        {
            Id=1,
            Name="Jan",
            Surname="Kowalski",
            City= "Warszawa",
            Image= "portrait1.jpg"
        },
           new()
        {
            Id=2,
            Name="Krzysztof",
            Surname="Krzyżanowski",
            City="Gdańsk",
           Image= "portrait2.jpg"
        },
           new()
        {
            Id=3,
            Name="Jurek",
            Surname="Mroczek",
               City= "Wrocław",
               Image= "portrait3.jpg"
        },
            new()
        {
            Id=4,
            Name="Karol",
            Surname="Kremówka",
            City= "Gdańsk",
            Image= "portrait08.jpg"
        },
    };
    public List<Group> groups = new()
    {
        new()
        {
            Id=1,
            Name="Grupa1",
            Icon= Icons.Material.Filled.Star

        },
           new()
        {
            Id=2,
            Name="Grupa2",
              Icon= Icons.Material.Filled.SmartToy

        },
           new()
        {
            Id=3,
            Name="Grupa3",
             Icon= Icons.Material.Filled.Cable
        },
            new()
        {
            Id=4,
            Name="Grupa4",
             Icon= Icons.Material.Filled.Crop
        },
            new()
        {
            Id=5,
            Name="Grupa5",
             Icon= Icons.Material.Filled.Square
        },
    };
    List<(string icon,string message)> messages = new();
    private int currentCount = 0;

    private void IncrementCount()
    {
        currentCount++;
    }
}
